import{u as d}from"./B5Z_Xqac.js";import{_ as h,r as p,g,C as m,m as f,c as r,b as w,a as n,t as l,D as x,o as a}from"./BLlQOcj0.js";const y=window.setInterval,b={setup(){d({title:"MSBIO抽奖"});const e=p(""),t=()=>{const i=new Date;e.value=i.toLocaleString("zh-CN",{timeZone:"Asia/Shanghai",hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})};let s;return g(()=>{t(),s=y(t,1e3)}),m(()=>{clearInterval(s)}),{shanghaiTime:e}},data(){return{msbioLogo:"msbio.avif",blocks:[{padding:"33",imgs:[{src:"1.webp",width:"100%",top:"5px",left:"4px",rotate:!0}]}],prizes:[{fonts:[{text:"雨伞",top:"10%",fontColor:"#92342A"}],background:"#FFD099",range:"30",imgs:[{src:"3.webp",width:"35%",top:"35px"}]},{fonts:[{text:"玩具",top:"10%",fontColor:"#92342A"}],background:"#FFFFFF",range:"30",imgs:[{src:"3.webp",width:"35%",top:"35px"}]},{fonts:[{text:"招财猫",top:"10%",fontColor:"#92342A"}],background:"#FFD099",range:"40",imgs:[{src:"3.webp",width:"35%",top:"35px"}]},{fonts:[{text:"小玩偶",top:"10%",fontColor:"#92342A"}],background:"#FFFFFF",range:"40",imgs:[{src:"3.webp",width:"35%",top:"35px"}]},{fonts:[{text:"冰箱贴",top:"10%",fontColor:"#92342A"}],background:"#FFD099",range:"100",imgs:[{src:"3.webp",width:"35%",top:"35px"}]},{fonts:[{text:"便签",top:"10%",fontColor:"#92342A"}],background:"#FFFFFF",range:"100",imgs:[{src:"3.webp",width:"35%",top:"35px"}]}],buttons:[{radius:"45%",imgs:[{src:"2.webp ",width:"80%",top:"-95%"}]}],isLuckyWheelVisible:!0,resultMessage:"",resultMessage1:""}},methods:{async startCallback(){this.$refs.myLucky.play();try{const e=await this.fetchLuckyIndex();if(e&&e.index!==void 0){const t=e.index;setTimeout(()=>{this.$refs.myLucky.stop(t)},3e3)}else console.error("未能获取有效的幸运索引")}catch(e){console.error("获取幸运索引失败",e)}},endCallback(e){console.log("恭喜中奖: "+e.fonts[0].text),alert("恭喜你抽到 "+e.fonts[0].text+"！"),this.resultMessage1=e.fonts[0].text},async fetchLuckyIndex(){try{const t=new URLSearchParams(window.location.search).get("openid");console.log("openid is ",t);const s=await fetch(`https://mini.msbiox.com/api/get_lucky_product_id/${t}`);if(s.status===404)return this.handleProductUnavailable(),null;if(s.status===400)return this.handleProductUnavailable1(),null;if(!s.ok)throw new Error("网络错误");return await s.json()}catch(e){throw this.handleProductUnavailable(),console.error("接口请求失败:",e),e}},handleProductUnavailable(){this.isLuckyWheelVisible=!1,this.showConfirmDialog("很抱歉，产品已经被抽完",()=>{this.resultMessage="十分感谢您的参与"})},handleProductUnavailable1(){this.isLuckyWheelVisible=!1,this.showConfirmDialog("很抱歉，你已经参与过次抽奖活动",()=>{this.resultMessage="十分感谢您的参与"})},showConfirmDialog(e,t){const s=window.confirm(e);t()}}},k={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center"}},_={key:0,style:{"margin-top":"20px"}},F={key:1,style:{"margin-top":"20px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center"}},v=["src"],C={style:{"font-weight":"bold","font-size":"30px"}},L={style:{"font-size":"20px","margin-top":"10px"}},M={key:2,style:{"margin-top":"20px",display:"flex","flex-direction":"column","align-items":"center","justify-content":"center"}},D=["src"],z={style:{"font-weight":"bold","font-size":"30px"}},P={style:{"font-size":"20px","margin-top":"10px"}};function V(e,t,s,i,o,c){const u=f("LuckyWheel");return a(),r("view",k,[o.isLuckyWheelVisible?(a(),r("view",_,[w(u,{ref:"myLucky",width:"350rpx",height:"350rpx",prizes:o.prizes,blocks:o.blocks,buttons:o.buttons,onStart:c.startCallback,onEnd:c.endCallback},null,8,["prizes","blocks","buttons","onStart","onEnd"])])):(a(),r("view",F,[n("img",{src:o.msbioLogo,style:{"margin-top":"20px",width:"50%",height:"auto"}},null,8,v),n("view",C,l(o.resultMessage),1),n("view",L,"当前时间："+l(i.shanghaiTime),1)])),o.resultMessage1&&o.isLuckyWheelVisible?(a(),r("view",M,[n("img",{src:o.msbioLogo,style:{"margin-top":"20px",width:"50%",height:"auto"}},null,8,D),n("view",z,"您获取的奖品为："+l(o.resultMessage1),1),t[0]||(t[0]=n("view",{style:{"font-size":"15px",color:"gray"}},"请勿刷新界面并截图以保存获奖记录",-1)),n("view",P,"当前时间："+l(i.shanghaiTime),1)])):x("",!0)])}const S=h(b,[["render",V]]);export{S as default};
